{"version":3,"sources":["../../../../src/js/components/Content/index.js"],"names":["Content","state","summary","promptPrefix","prompt","history","historyCounter","input","keyInputs","canScroll","controller","componentWillMount","data","context","instances","find","i","index","props","id","oldData","setState","componentDidMount","focusInput","unregister","register","keys","length","handleChange","target","value","key","dontShowCommand","componentDidUpdate","inputWrapper","scrollIntoView","setScrollPosition","pos","setTimeout","contentWrapper","scrollTop","com","focus","e","handleKeyPress","handlerKeyPress","handleOuterKeypress","indexOf","document","activeElement","char","maximise","activeTab","barShowing","tabsShowing","output","map","content","Array","isArray","cont","marginRight","__html","toSubtract","maxWidth","maxHeight","overflowY","ctw","elm","displayName","propTypes","string","object","func","isRequired","defaultProps","contextTypes","bool","array"],"mappings":"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","file":"index.js","sourcesContent":["import React, {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport ansiHTML from \"ansi-html\";\r\nimport whatkey, {unprintableKeys} from 'whatkey';\r\nimport {\r\n  ContainerMain, ContainerContent, Holder,\r\n  Input, InputArea, MainInput,\r\n  OutputLine, PreOutputLine, Prompt,\r\n} from './styled-elements';\r\n\r\nclass Content extends Component {\r\n  static displayName = 'Content';\r\n\r\n  static propTypes = {\r\n    id: PropTypes.string,\r\n    oldData: PropTypes.object, // eslint-disable-line\r\n    prompt: PropTypes.string,\r\n    register: PropTypes.func,\r\n    handleChange: PropTypes.func,\r\n    handlerKeyPress: PropTypes.func.isRequired,\r\n  };\r\n\r\n  static defaultProps = {\r\n    prompt: '>',\r\n    oldData: {},\r\n  };\r\n\r\n  static contextTypes = {\r\n    maximise: PropTypes.bool,\r\n    instances: PropTypes.array,\r\n    activeTab: PropTypes.string,\r\n    barShowing: PropTypes.bool,\r\n    tabsShowing: PropTypes.bool,\r\n  };\r\n\r\n  state = {\r\n    summary: [],\r\n    promptPrefix: '',\r\n    prompt: '>',\r\n    history: [],\r\n    historyCounter: 0,\r\n    input: [],\r\n    keyInputs: [],\r\n    canScroll: true,\r\n    controller: null,\r\n  };\r\n\r\n  componentWillMount = () => {\r\n    const data = this.context.instances.find(i => i.index === this.props.id);\r\n    let state = {prompt: this.props.prompt};\r\n    if (data) {\r\n      state = {...state, ...data.oldData};\r\n    }\r\n    this.setState(state);\r\n  };\r\n\r\n  componentDidMount = () => {\r\n    this.focusInput();\r\n    const data = this.context.instances.find(i => i.index === this.props.id);\r\n    this.unregister = this.props.register(this);\r\n    if (!data || Object.keys(data.oldData).length === 0) {\r\n      this.handleChange({target: {value: 'show'}, key: 'Enter', dontShowCommand: true});\r\n    }\r\n  };\r\n\r\n  // Adjust scrolling\r\n  componentDidUpdate = () => {\r\n    if (this.inputWrapper !== null) {\r\n      this.inputWrapper.scrollIntoView(false);\r\n    }\r\n  };\r\n\r\n  componentWillUnmount() {\r\n    this.unregister(this.state);\r\n  }\r\n\r\n  setScrollPosition = (pos) => {\r\n    setTimeout(() => {\r\n      if (this.contentWrapper !== null) {\r\n        this.contentWrapper.scrollTop = pos;\r\n      }\r\n    }, 50);\r\n  };\r\n\r\n  focusInput = () => {\r\n    if (this.com !== null) {\r\n      this.com.focus();\r\n    }\r\n  };\r\n\r\n  handleChange = (e) => {\r\n    this.props.handleChange(this, e);\r\n  }\r\n\r\n  handleKeyPress = (e) => {\r\n    this.props.handlerKeyPress(this, e, this.com);\r\n  }\r\n\r\n  handleOuterKeypress = (e) => {\r\n    const {key} = whatkey(e);\r\n    const actionKeys = ['up', 'down', 'left', 'right', 'enter'];\r\n    if (unprintableKeys.indexOf(key) < 0) {\r\n      if (document.activeElement !== this.com) {\r\n        this.com.focus();\r\n        this.com.value += whatkey(e).char;\r\n      }\r\n    } else if (actionKeys.indexOf(key) > -1) {\r\n      this.com.focus();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {id} = this.props;\r\n    const {\r\n      maximise, activeTab, barShowing, tabsShowing,\r\n    } = this.context;\r\n\r\n    if (id !== activeTab) {\r\n      return null;\r\n    }\r\n\r\n    const output = this.state.summary.map((content, i) => {\r\n      if (typeof content === 'string' && content.length === 0) {\r\n        return <OutputLine key={i}>&nbsp;</OutputLine>;\r\n      }\r\n      return (\r\n        <PreOutputLine key={i}>\r\n          {\r\n            Array.isArray(content) ?\r\n              content.map((cont, key) => (\r\n                <span style={{marginRight: 5}} key={`inner-${key}`} dangerouslySetInnerHTML={{__html: ansiHTML(cont)}}/>\r\n              )) :\r\n              <span dangerouslySetInnerHTML={{__html: ansiHTML(content)}}/>\r\n          }\r\n        </PreOutputLine>\r\n      );\r\n    });\r\n\r\n    let toSubtract = 30;\r\n    if (!barShowing) {\r\n      toSubtract -= 30;\r\n    }\r\n    if (tabsShowing) {\r\n      toSubtract += 30;\r\n    }\r\n\r\n    return (\r\n      <ContainerMain\r\n        style={{\r\n          ...(maximise\r\n            ? {maxWidth: '100%', maxHeight: `calc(100% - ${toSubtract}px)`}\r\n            : {}),\r\n          ...(this.state.canScroll\r\n            ? {overflowY: 'auto'}\r\n            : {overflowY: 'hidden'}),\r\n        }}\r\n        tabIndex=\"0\"\r\n        onKeyUp={this.handleOuterKeypress}\r\n        innerRef={(ctw) => {\r\n          this.contentWrapper = ctw;\r\n        }}\r\n      >\r\n        <Holder>\r\n          <ContainerContent>\r\n            <InputArea>\r\n              {output}\r\n              <Input\r\n                innerRef={(elm) => {\r\n                  this.inputWrapper = elm;\r\n                }}\r\n              >\r\n                <Prompt>\r\n                  {this.state.promptPrefix + this.state.prompt}\r\n                </Prompt>\r\n                <MainInput\r\n                  type=\"text\"\r\n                  tabIndex=\"-1\"\r\n                  innerRef={(com) => {\r\n                    this.com = com;\r\n                  }}\r\n                  onKeyPress={this.handleChange}\r\n                  onKeyDown={this.handleKeyPress}\r\n                />\r\n              </Input>\r\n            </InputArea>\r\n          </ContainerContent>\r\n        </Holder>\r\n      </ContainerMain>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Content;\r\n"]}